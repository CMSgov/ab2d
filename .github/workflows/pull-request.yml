name: pull request jobs

on:
  pull_request:

jobs:
  #unit-integration-test:
  #  uses: ./.github/workflows/unit-integration-test.yml
  #  secrets: inherit
  build-api:
    #needs: unit-integration-test
    uses: ./.github/workflows/build.yml
    with:
      environment: test
      module: api
    secrets: inherit
  build-worker:
    #needs: unit-integration-test
    uses: ./.github/workflows/build.yml
    with:
      environment: test
      module: worker
    secrets: inherit
  deploy-api:
    needs: build-api
    uses: ./.github/workflows/deploy.yml
    with:
      environment: test
      module: api
    secrets: inherit
  deploy-worker:
    needs: build-worker
    uses: ./.github/workflows/deploy.yml
    with:
      environment: test
      module: worker
    secrets: inherit
  e2e-test:
    needs: [deploy-api, deploy-worker]
    uses: ./.github/workflows/e2e-test.yml
    with:
      environment: test
    secrets: inherit
